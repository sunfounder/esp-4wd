

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>APP Control &mdash; SunFounder ESP-4WD Car Kit  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="FAQ" href="faq.html" />
    <link rel="prev" title="Code Control" href="code_control_micropython.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> SunFounder ESP-4WD Car Kit
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction_to_esp32_rdp.html">Introduction to ESP32 RDP</a></li>
<li class="toctree-l1"><a class="reference internal" href="components_list.html">Components List</a></li>
<li class="toctree-l1"><a class="reference internal" href="for_arduino_user.html">For Arduino User</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="for_micropython_user.html">For MicroPython User</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="preparations_micropython.html">Preparations</a></li>
<li class="toctree-l2"><a class="reference internal" href="test_the_components_with_micropython.html">Test the Components with MicroPython</a></li>
<li class="toctree-l2"><a class="reference internal" href="hardware_assembly_micropython.html">Hardware Assembling</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="play_the_car_with_micropython.html">Play the Car with MicroPython</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="code_control_micropython.html">Code Control</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">APP Control</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#install-sunfounder-controller">Install Sunfounder Controller</a></li>
<li class="toctree-l4"><a class="reference internal" href="#about-sunfounder-controller">About Sunfounder Controller</a></li>
<li class="toctree-l4"><a class="reference internal" href="#establish-communication">Establish Communication</a></li>
<li class="toctree-l4"><a class="reference internal" href="#control-the-car-with-app">Control the Car with APP</a></li>
<li class="toctree-l4"><a class="reference internal" href="#diy-controller">DIY Controller</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQ</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">SunFounder ESP-4WD Car Kit</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="for_micropython_user.html">For MicroPython User</a> &raquo;</li>
        
          <li><a href="play_the_car_with_micropython.html">Play the Car with MicroPython</a> &raquo;</li>
        
      <li>APP Control</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/app_control_micropython.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="app-control">
<span id="app-control-micropython"></span><h1>APP Control<a class="headerlink" href="#app-control" title="Permalink to this headline">¶</a></h1>
<p>In this chapter, you will learn to use a APP - Sunfounder Controller to control the car.</p>
<p>The complete operation process is as follows：<strong>Install Sunfounder Controller</strong> -&gt; <strong>Establish Communication</strong> -&gt; <strong>Control the Car with APP</strong>.</p>
<p>You can check the <strong>About Sunfounder Controller</strong> and <strong>DIY Controller</strong> sections according to your choice.</p>
<ul class="simple">
<li><p><a class="reference internal" href="#micropython-install-sunfounder-controller"><span class="std std-ref">Install Sunfounder Controller</span></a></p></li>
<li><p><a class="reference internal" href="#micropython-about-sunfounder-controller"><span class="std std-ref">About Sunfounder Controller</span></a></p></li>
<li><p><a class="reference internal" href="#micropython-establish-communication"><span class="std std-ref">Establish Communication</span></a></p></li>
<li><p><a class="reference internal" href="#micropython-control-the-car-with-app"><span class="std std-ref">Control the Car with APP</span></a></p></li>
<li><p><a class="reference internal" href="#micropython-diy-controller"><span class="std std-ref">DIY Controller</span></a></p></li>
</ul>
<div class="section" id="install-sunfounder-controller">
<span id="micropython-install-sunfounder-controller"></span><h2>Install Sunfounder Controller<a class="headerlink" href="#install-sunfounder-controller" title="Permalink to this headline">¶</a></h2>
<p>Open App Store (iOS/Mac OS X system) or Play Store (Android/Windows/Linux system), then search and download Sunfounder Controller.</p>
<img alt="_images/arduino_app1.png" class="align-center" src="_images/arduino_app1.png" />
</div>
<div class="section" id="about-sunfounder-controller">
<span id="micropython-about-sunfounder-controller"></span><h2>About Sunfounder Controller<a class="headerlink" href="#about-sunfounder-controller" title="Permalink to this headline">¶</a></h2>
<div class="section" id="page-introduction">
<h3>Page Introduction<a class="headerlink" href="#page-introduction" title="Permalink to this headline">¶</a></h3>
<p>Start the Sunfounder Controller.</p>
<a class="reference internal image-reference" href="_images/arduino_app2.png"><img alt="_images/arduino_app2.png" class="align-center" src="_images/arduino_app2.png" style="width: 150px;" /></a>
<p>Click the middle button to add a new controller.</p>
<a class="reference internal image-reference" href="_images/arduino_app3.png"><img alt="_images/arduino_app3.png" class="align-center" src="_images/arduino_app3.png" style="width: 450px;" /></a>
<p>Sunfounder Controller is a platform that can add custom controllers. It
reserves many widget interfaces. There are a total of 17 areas from A to Q. Each area
has selectable widgets.</p>
<a class="reference internal image-reference" href="_images/arduino_app4.png"><img alt="_images/arduino_app4.png" class="align-center" src="_images/arduino_app4.png" style="width: 450px;" /></a>
<p>The available widgets in the <strong>large square area</strong> include joystick and D-Pad.</p>
<a class="reference internal image-reference" href="_images/arduino_app5.png"><img alt="_images/arduino_app5.png" class="align-center" src="_images/arduino_app5.png" style="width: 400px;" /></a>
<p>The available widgets in the <strong>small square area</strong> include button, digital display and switch.</p>
<a class="reference internal image-reference" href="_images/arduino_app6.png"><img alt="_images/arduino_app6.png" class="align-center" src="_images/arduino_app6.png" style="width: 360px;" /></a>
<p>The available widgets for the <strong>rectangular area</strong> include slider, dial, ultrasonic radar and grayscale detection tool.</p>
<a class="reference internal image-reference" href="_images/arduino_app7.png"><img alt="_images/arduino_app7.png" class="align-center" src="_images/arduino_app7.png" style="width: 510px;" /></a>
</div>
<div class="section" id="widgets-list">
<h3>Widgets List<a class="headerlink" href="#widgets-list" title="Permalink to this headline">¶</a></h3>
<p>Here, you will learn the parameter types and ranges of control widgets and data widgets.</p>
<p><strong>Control Widgets</strong></p>
<p>The control widgets of Sunfounder Controller include buttons, switches, joystick, D-Pad, and slider.</p>
<p>You can modify the name, parameter range and initial value of some widgets by clicking the settings button in the upper right corner.</p>
<a class="reference internal image-reference" href="_images/arduino_app8.png"><img alt="_images/arduino_app8.png" class="align-center" src="_images/arduino_app8.png" style="width: 550px;" /></a>
<p>When we use these control widgets,  proofreading information of the ESP-4WD car will receive the control data.
Through these control data, we can write code to control the car.</p>
<a class="reference internal image-reference" href="_images/arduino_app9.png"><img alt="_images/arduino_app9.png" class="align-center" src="_images/arduino_app9.png" style="width: 700px;" /></a>
<p><strong>Data Widgets</strong></p>
<p>The data widget of Sunfounder Controller includes digital displays, dial, ultrasonic
radar, and grayscale detection tool.</p>
<p>When we send sensor data to these data widgets, we can show the data on the
corresponding widgets. At the same time, you can also modify the name, unit and
parameter range of the data widget by clicking the setting icon in the upper right
corner.</p>
<a class="reference internal image-reference" href="_images/arduino_app10.png"><img alt="_images/arduino_app10.png" class="align-center" src="_images/arduino_app10.png" style="width: 700px;" /></a>
</div>
</div>
<div class="section" id="establish-communication">
<span id="micropython-establish-communication"></span><h2>Establish Communication<a class="headerlink" href="#establish-communication" title="Permalink to this headline">¶</a></h2>
<p>There are two ways to establish communication between Sunfounder Controller and ESP-4WD car: One is AP mode, the other is STA mode.</p>
<ul class="simple">
<li><p><strong>AP Mode</strong>: You need to connect Sunfounder Contorller to the hotspot released by ESP-4WD car.</p></li>
<li><p><strong>STA Mode</strong>: You need to connect Sunfounder Controller and ESP-4WD car to the same LAN.</p></li>
</ul>
<p>We can switch the communication mode by modifying the code <code class="docutils literal notranslate"><span class="pre">ws.py</span></code> and defining the <code class="docutils literal notranslate"><span class="pre">SWITCH_MODE</span></code> variable as <code class="docutils literal notranslate"><span class="pre">ap</span></code> or <code class="docutils literal notranslate"><span class="pre">sta</span></code>.</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">SWITCH_MODE</span> <span class="o">=</span> <span class="s2">&quot;ap&quot;</span>
</pre></div>
</div>
</div></blockquote>
<div class="section" id="ap-mode">
<h3>AP Mode<a class="headerlink" href="#ap-mode" title="Permalink to this headline">¶</a></h3>
<p>If you want to use AP mode, you need to connect Sunfounder Contorller to the hotspot released by ESP-4WD car.</p>
<ol class="arabic simple">
<li><p>Open the code <code class="docutils literal notranslate"><span class="pre">ws.py</span></code>, modify the NAME and AP_PASSWORD to yours.</p></li>
</ol>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">NAME</span> <span class="o">=</span> <span class="s1">&#39;ESP-4WD Car&#39;</span>
<span class="n">AP_PASSWORD</span> <span class="o">=</span> <span class="s2">&quot;123456789&quot;</span>
</pre></div>
</div>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The NAME in the code is both the SSID and the name of the car, if you have more than one EPS-4WD car, you need to set different NAMEs for them to avoid a wrong connection.</p>
<p>In addition, you need to set a password of more than 8 digits.</p>
</div>
<ol class="arabic simple" start="2">
<li><p>Then define the <code class="docutils literal notranslate"><span class="pre">SWITCH_MODE</span></code> variable as <code class="docutils literal notranslate"><span class="pre">ap</span></code>.</p></li>
</ol>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">SWITCH_MODE</span> <span class="o">=</span> <span class="s2">&quot;ap&quot;</span>
</pre></div>
</div>
</div></blockquote>
<p>3. After downloading the code, ESP-4WD car will send a hotspot signal, then take out your
mobile device, open the WLAN management interface and connect to the wifi network.</p>
<a class="reference internal image-reference" href="_images/arduino_app12.png"><img alt="_images/arduino_app12.png" class="align-center" src="_images/arduino_app12.png" style="width: 400px;" /></a>
<ol class="arabic simple" start="4">
<li><p>Open <strong>Sunfounder Controller</strong> and click the <strong>Connect</strong> icon on the top right corner.</p></li>
</ol>
<a class="reference internal image-reference" href="_images/arduino_app_new1.png"><img alt="_images/arduino_app_new1.png" class="align-center" src="_images/arduino_app_new1.png" style="width: 300px;" /></a>
<ol class="arabic simple" start="5">
<li><p>A prompt box will appear if the connection is successful.</p></li>
</ol>
<a class="reference internal image-reference" href="_images/arduino_app_new2.png"><img alt="_images/arduino_app_new2.png" class="align-center" src="_images/arduino_app_new2.png" style="width: 400px;" /></a>
<ol class="arabic simple" start="6">
<li><p>And the name of the car will be shown on APP.</p></li>
</ol>
<a class="reference internal image-reference" href="_images/arduino_app_new3.png"><img alt="_images/arduino_app_new3.png" class="align-center" src="_images/arduino_app_new3.png" style="width: 300px;" /></a>
</div>
<div class="section" id="sta-mode">
<h3>STA Mode<a class="headerlink" href="#sta-mode" title="Permalink to this headline">¶</a></h3>
<p>If you want to use STA mode, you need to connect Sunfounder Controller and ESP-4WD car to the same LAN.</p>
<ol class="arabic simple">
<li><p>Open the code <code class="docutils literal notranslate"><span class="pre">ws.py</span></code>, modify the STA_NAME and STA_PASSWORD to yours.</p></li>
</ol>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">STA_NAME</span> <span class="o">=</span> <span class="s2">&quot;MakerStarsHall&quot;</span>
<span class="n">STA_PASSWORD</span> <span class="o">=</span> <span class="s2">&quot;sunfounder&quot;</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>Then define the <code class="docutils literal notranslate"><span class="pre">SWITCH_MODE</span></code> variable as <code class="docutils literal notranslate"><span class="pre">sta</span></code>.</p></li>
</ol>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">SWITCH_MODE</span> <span class="s">&quot;sta&quot;</span>
</pre></div>
</div>
</div></blockquote>
<p>3. After downloading the code, ESP-4WD car will automatically connect to the wifi network, and at the same time take out your mobile device, open the WLAN management interface
and connect to this wifi network.</p>
<a class="reference internal image-reference" href="_images/arduino_app13_.png"><img alt="_images/arduino_app13_.png" class="align-center" src="_images/arduino_app13_.png" style="width: 400px;" /></a>
<ol class="arabic simple" start="4">
<li><p>Open Sunfounder Controller and click the <strong>Connect</strong> icon on the top right corner.</p></li>
</ol>
<a class="reference internal image-reference" href="_images/arduino_app_new1.png"><img alt="_images/arduino_app_new1.png" class="align-center" src="_images/arduino_app_new1.png" style="width: 300px;" /></a>
<ol class="arabic simple" start="5">
<li><p>Find the car name in the pop-up window and click on it.</p></li>
</ol>
<a class="reference internal image-reference" href="_images/arduino_app_new4.png"><img alt="_images/arduino_app_new4.png" class="align-center" src="_images/arduino_app_new4.png" style="width: 450px;" /></a>
<ol class="arabic simple" start="6">
<li><p>After connecting, the name of the car will be shown on APP.</p></li>
</ol>
<a class="reference internal image-reference" href="_images/arduino_app_new3.png"><img alt="_images/arduino_app_new3.png" class="align-center" src="_images/arduino_app_new3.png" style="width: 300px;" /></a>
</div>
</div>
<div class="section" id="control-the-car-with-app">
<span id="micropython-control-the-car-with-app"></span><h2>Control the Car with APP<a class="headerlink" href="#control-the-car-with-app" title="Permalink to this headline">¶</a></h2>
<p>Either way, you can get the SunFounder Controller and ESP-4WD car to establish communication, next you will learn how to control the car with APP.</p>
<ol class="arabic simple">
<li><p>Open Sunfounder Controller, click the <strong>+</strong> to create an empty controller.</p></li>
</ol>
<a class="reference internal image-reference" href="_images/arduino_app3.png"><img alt="_images/arduino_app3.png" class="align-center" src="_images/arduino_app3.png" style="width: 450px;" /></a>
<ol class="arabic simple" start="2">
<li><p>As shown in the figure, select the corresponding widget and click the icon in the upper right corner to save.</p></li>
</ol>
<ul class="simple">
<li><p><strong>Widget A</strong>: Show the driving speed of the car.</p></li>
<li><p><strong>Widget D</strong>: Simulate radar scanning.</p></li>
<li><p><strong>Widget H</strong>: Control the driving speed of the car.</p></li>
<li><p><strong>Widget K</strong>: Control the driving direction of the car.</p></li>
<li><p><strong>Widget L</strong>: Show the detection result of the grayscale sensor.</p></li>
<li><p><strong>Widget M</strong>: Control the on and off of the RGB board.</p></li>
</ul>
<a class="reference internal image-reference" href="_images/arduino_app14_.png"><img alt="_images/arduino_app14_.png" class="align-center" src="_images/arduino_app14_.png" style="width: 450px;" /></a>
<ol class="arabic simple" start="3">
<li><p>Click the start button in the upper right corner, and then try to use these widgets to control ESP-4WD car.</p></li>
</ol>
<a class="reference internal image-reference" href="_images/arduino_app15.png"><img alt="_images/arduino_app15.png" class="align-center" src="_images/arduino_app15.png" style="width: 450px;" /></a>
</div>
<div class="section" id="diy-controller">
<span id="micropython-diy-controller"></span><h2>DIY Controller<a class="headerlink" href="#diy-controller" title="Permalink to this headline">¶</a></h2>
<p>If you want to DIY a new controller, you need to understand the communication process between the ESP-4WD car and the Sunfounder Controller. Open the
<code class="docutils literal notranslate"><span class="pre">test_control.py</span></code> file. You will go through this code to see how they communicate with each other.</p>
<div class="section" id="program-framework">
<h3>Program framework<a class="headerlink" href="#program-framework" title="Permalink to this headline">¶</a></h3>
<p>First, let us understand the general operating framework of the program.</p>
<p>Turn the code to line 34. In the <code class="docutils literal notranslate"><span class="pre">main()</span></code> function, we have written the basic
implementation code for build a controller.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ws.start()</span></code>: Establish communication between ESP-4WD car and Sunfounder Controller.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">result</span> <span class="pre">=</span> <span class="pre">read()</span></code>: Read the received data and store it in the result variable.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">write()</span></code>：Send sensor data to Sunfounder Controller.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">ws</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;start&quot;</span><span class="p">)</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">read</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">result</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># coding the control function here.</span>

            <span class="c1"># coding the sensor function here.</span>

            <span class="c1"># ws.send_dict[&#39;L_region&#39;] = car.get_grayscale_list() # example for test sensor date sending.</span>
            <span class="n">write</span><span class="p">()</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep_ms</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
</pre></div>
</div>
<p>Open the <code class="docutils literal notranslate"><span class="pre">ws.py</span></code> file, turn the code to line 87, in the <code class="docutils literal notranslate"><span class="pre">start()</span></code> function, we switch the
communication mode by judging the value of <code class="docutils literal notranslate"><span class="pre">SWITCH_MODE</span></code> .</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">SWITCH_MODE</span> <span class="o">==</span> <span class="s2">&quot;ap&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wlan</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">WLAN</span><span class="p">(</span><span class="n">network</span><span class="o">.</span><span class="n">AP_IF</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wlan</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">essid</span><span class="o">=</span><span class="n">AP_NAME</span><span class="p">,</span> <span class="n">authmode</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">AP_PASSWORD</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wlan</span><span class="o">.</span><span class="n">active</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># turning on the hotspot</span>
    <span class="k">elif</span> <span class="n">SWITCH_MODE</span> <span class="o">==</span> <span class="s2">&quot;sta&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wlan</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">WLAN</span><span class="p">(</span><span class="n">network</span><span class="o">.</span><span class="n">STA_IF</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wlan</span><span class="o">.</span><span class="n">active</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wlan</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">STA_NAME</span><span class="p">,</span> <span class="n">STA_PASSWORD</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="receiving">
<h3>Receiving<a class="headerlink" href="#receiving" title="Permalink to this headline">¶</a></h3>
<p>The ESP-4WD car receives data from the Sunfounder Controller and sends its own sensor data to the Sunfounder Controller.
Let’s find out what data ESP-4WD car receives from Sunfounder Controller.</p>
<p><strong>Step 1: Create new controller</strong></p>
<p>Run the <code class="docutils literal notranslate"><span class="pre">test_control.py</span></code> file, re-establish communication, and then open Sunfounder Controller to create
a new controller. We add a slider in the H area and a D-Pad in the K area. After
adding, click the icon in the upper right corner to save.</p>
<a class="reference internal image-reference" href="_images/arduino_app16.png"><img alt="_images/arduino_app16.png" class="align-center" src="_images/arduino_app16.png" style="width: 450px;" /></a>
<p><strong>Step 2: Receive data from SunFounder Controller</strong></p>
<p>Turn the code to line 14, in the <code class="docutils literal notranslate"><span class="pre">read()</span></code> function, we have realized the receiving and printing of the data sent by the Sunfounder Controller.
The function of the variable <code class="docutils literal notranslate"><span class="pre">temp</span></code> is to prevent repeated printing of data.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">read</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">temp</span>
    <span class="n">recv</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">recv</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">recv_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">recv</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">temp</span> <span class="o">!=</span> <span class="n">recv_data</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;recv_data: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">recv_data</span><span class="p">)</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">recv_data</span>
    <span class="k">return</span> <span class="n">recv_data</span>
</pre></div>
</div>
<ul>
<li><p>Receive the Json object sent by Sunfounder Controller through the <code class="docutils literal notranslate"><span class="pre">ws.read()</span></code> function and store it in the <code class="docutils literal notranslate"><span class="pre">recv</span></code> variable.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">recv</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div>
</div>
</li>
<li><p>The variable <code class="docutils literal notranslate"><span class="pre">recv</span></code> (Json object format) is parsed into <code class="docutils literal notranslate"><span class="pre">recv_data</span></code> dictionary through the <code class="docutils literal notranslate"><span class="pre">json.loads()</span></code> function.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">recv_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">recv</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Print the value of variable <code class="docutils literal notranslate"><span class="pre">recv_data</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;recv_data: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">recv_data</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
<p>Click the start icon in the upper right corner to run the controller.</p>
<img alt="_images/arduino_app17.png" class="align-center" src="_images/arduino_app17.png" />
<p>Open the Shell window under Thonny, we can find that the initial data of K
control is the string <code class="docutils literal notranslate"><span class="pre">stop</span></code>, and the initial data of H widget is the int value 50.</p>
<a class="reference internal image-reference" href="_images/arduino_app18.png"><img alt="_images/arduino_app18.png" class="align-center" src="_images/arduino_app18.png" style="width: 450px;" /></a>
<p>Press the arrow keys of the <strong>D-Pad</strong> in the K area and slide the <strong>slider</strong> in the H area.</p>
<a class="reference internal image-reference" href="_images/arduino_app19.png"><img alt="_images/arduino_app19.png" class="align-center" src="_images/arduino_app19.png" style="width: 450px;" /></a>
<p>You can see that the <strong>D-Pad</strong> widget sends a string of data (“forward”, “backward”,”left”,”right”) to the ESP-4WD car, while the slider widget will send an int data (range: 0-100).</p>
<a class="reference internal image-reference" href="_images/arduino_app20.png"><img alt="_images/arduino_app20.png" class="align-center" src="_images/arduino_app20.png" style="width: 450px;" /></a>
<p><strong>Step 3: Responding</strong></p>
<p>When ESP-4WD car receives data from Sunfounder Controller, it needs to respond accordingly.</p>
<p>Let’s write a piece of code that uses the widgets on the Sunfounder Controller to control the movement of the car. The K widget(D-Pad) controls the direction of the car, and the H widget(slider) controls the speed of the car.</p>
<p>Add the following highlighted code to line 41 (a blank line).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>  <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
  <span class="n">ws</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;start&quot;</span><span class="p">)</span>
  <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
      <span class="n">result</span> <span class="o">=</span> <span class="n">read</span><span class="p">()</span>
      <span class="k">if</span> <span class="n">result</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
          <span class="c1"># coding the control function here.</span>
<span class="hll">          <span class="n">car</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;K_region&#39;</span><span class="p">],</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;H_region&#39;</span><span class="p">])</span>
</span>          <span class="c1"># coding the sensor function here.</span>

          <span class="c1"># ws.send_dict[&#39;L_region&#39;] = car.get_grayscale_list() # example for test sensor date sending.</span>
          <span class="n">write</span><span class="p">()</span>
      <span class="n">time</span><span class="o">.</span><span class="n">sleep_ms</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
</pre></div>
</div>
<ul>
<li><p>Through the <code class="docutils literal notranslate"><span class="pre">read()</span></code> function, you can receive the data sent by Sunfounder Controller and store it in the result dictionary.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">read</span><span class="p">()</span>
</pre></div>
</div>
</li>
<li><p>Pass <code class="docutils literal notranslate"><span class="pre">result['K_region']</span></code> as the first parameter to the <code class="docutils literal notranslate"><span class="pre">car.move()</span></code> function to control the direction of the ESP-4WD car. Pass <code class="docutils literal notranslate"><span class="pre">result['H_region']</span></code> as the second parameter to the <code class="docutils literal notranslate"><span class="pre">car.move()</span></code> function to control the speed.</p></li>
<li><p>The value of <code class="docutils literal notranslate"><span class="pre">result['K_region']</span></code> is the string data (“forward”, “backward”,”left”,”right”) sent by the K widget (D-Pad), the same as the value of <code class="docutils literal notranslate"><span class="pre">result['H_region']</span></code> is the int data sent by H widget (slide) (range: 0-100).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">car</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;K_region&#39;</span><span class="p">],</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;H_region&#39;</span><span class="p">])</span>
</pre></div>
</div>
</li>
</ul>
<p>After save and run the modified code and re-establishing communication, open the controller and click the start icon in the upper right corner to run it.</p>
<p>The D-Pad in the K area can control the direction of the ESP-4WD car, and the slider in the H area can control the speed.</p>
<img alt="_images/arduino_app17.png" class="align-center" src="_images/arduino_app17.png" />
</div>
<div class="section" id="sending">
<h3>Sending<a class="headerlink" href="#sending" title="Permalink to this headline">¶</a></h3>
<p>Let’s take a closer look at how the ESP-4WD car sends its own sensor data to the Sunfounder Controller.</p>
<p><strong>Step 1: Create new controller</strong></p>
<p>Open the <strong>test_control.py</strong> file and go to line 44, delete the comment symbol for this code.</p>
<p>This code is used to get the grey scale sensor data from the <code class="docutils literal notranslate"><span class="pre">car.get_grayscale_list()</span></code> function and store it in the <code class="docutils literal notranslate"><span class="pre">ws.send_dict</span></code> dictionary and define the key as <code class="docutils literal notranslate"><span class="pre">L_region</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>  <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
  <span class="n">ws</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;start&quot;</span><span class="p">)</span>
  <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
      <span class="n">result</span> <span class="o">=</span> <span class="n">read</span><span class="p">()</span>
      <span class="k">if</span> <span class="n">result</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
<span class="hll">          <span class="c1"># coding the control function here.</span>
</span>
          <span class="c1"># coding the sensor function here.</span>

          <span class="n">ws</span><span class="o">.</span><span class="n">send_dict</span><span class="p">[</span><span class="s1">&#39;L_region&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">car</span><span class="o">.</span><span class="n">get_grayscale_list</span><span class="p">()</span> <span class="c1"># example for test sensor date sending.</span>
          <span class="n">write</span><span class="p">()</span>
      <span class="n">time</span><span class="o">.</span><span class="n">sleep_ms</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
</pre></div>
</div>
<p>Save and run this code, re-establish communication, and then open Sunfounder Controller to create a new controller. We add a grayscale detection tool in the L area. After adding,
click the icon in the upper right corner to save.</p>
<a class="reference internal image-reference" href="_images/arduino_app21.png"><img alt="_images/arduino_app21.png" class="align-center" src="_images/arduino_app21.png" style="width: 450px;" /></a>
<p><strong>Step 2: Receive data from SunFounder Controller</strong></p>
<p>Open the <code class="docutils literal notranslate"><span class="pre">ws.py</span></code> file and go to line 25. Here, the equipment information and proofreading
information of ESP-4WD Car are stored in the <code class="docutils literal notranslate"><span class="pre">send_dict</span></code> dictionary.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">send_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Name&#39;</span><span class="p">:</span><span class="n">AP_NAME</span><span class="p">,</span>
    <span class="s1">&#39;Type&#39;</span><span class="p">:</span><span class="s1">&#39;ESP-4WD Car&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Check&#39;</span><span class="p">:</span><span class="s1">&#39;SunFounder Controller&#39;</span><span class="p">,</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>Open the <code class="docutils literal notranslate"><span class="pre">test_control.py</span></code> and go to line 26, through the <code class="docutils literal notranslate"><span class="pre">write()</span></code> function, we send sensor data to the Sunfounder Controller,
where the variable <code class="docutils literal notranslate"><span class="pre">temp_send</span></code> is used to prevent repeated printing of data.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">write</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">temp_send</span>
<span class="hll">    <span class="n">ws</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">send_dict</span><span class="p">))</span>
</span>    <span class="k">if</span> <span class="n">temp_send</span> <span class="o">!=</span> <span class="n">ws</span><span class="o">.</span><span class="n">send_dict</span><span class="p">:</span>
<span class="hll">        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;send_data:</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">ws</span><span class="o">.</span><span class="n">send_dict</span><span class="p">)</span>
</span>        <span class="n">temp_send</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">send_dict</span><span class="o">.</span><span class="n">copy</span>
    <span class="k">return</span>
</pre></div>
</div>
<ul>
<li><p>First, use the <code class="docutils literal notranslate"><span class="pre">json.dumps()</span></code> function to convert the <code class="docutils literal notranslate"><span class="pre">ws.send_dict</span></code> dictionary into a Json object, and then use the <code class="docutils literal notranslate"><span class="pre">ws.write()</span></code> function to send the Json object storing the sensor data to the Sunfounder Controller.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ws</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">send_dict</span><span class="p">))</span>
</pre></div>
</div>
</li>
<li><p>Then print the value of the <code class="docutils literal notranslate"><span class="pre">ws.send_dict</span> <span class="pre">dictionary</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;send_data:</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">ws</span><span class="o">.</span><span class="n">send_dict</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
<p>Click the start icon in the upper right corner to run the controller.</p>
<img alt="_images/arduino_app17.png" class="align-center" src="_images/arduino_app17.png" />
<p>Open the Shell window under Thonny, you will see that the ESP-4WD car has been sending device information, calibration information and the value of the grayscale sensor to the Sunfounder Controller.</p>
<a class="reference internal image-reference" href="_images/arduino_app22.png"><img alt="_images/arduino_app22.png" class="align-center" src="_images/arduino_app22.png" style="width: 450px;" /></a>
<p><strong>Step 3: Responding</strong></p>
<p>Let’s write a piece of code that show the sensor data of Sunfounder Controller. Widget L (grayscale detection tool) will show you the grayscale of the ground.</p>
<p>Turn the code to line 34, Let’s re-explain the content of the <code class="docutils literal notranslate"><span class="pre">main()</span></code> event.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">ws</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;start&quot;</span><span class="p">)</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">read</span><span class="p">()</span>
<span class="hll">        <span class="k">if</span> <span class="n">result</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
</span><span class="hll">            <span class="n">ws</span><span class="o">.</span><span class="n">send_dict</span><span class="p">[</span><span class="s1">&#39;L_region&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">car</span><span class="o">.</span><span class="n">get_grayscale_list</span><span class="p">()</span>
</span>            <span class="n">write</span><span class="p">()</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep_ms</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
</pre></div>
</div>
<ul>
<li><p>By <code class="docutils literal notranslate"><span class="pre">car.get_grayscale_list()</span></code> function, we can get the list of grayscale sensor detection values and assign them to <code class="docutils literal notranslate"><span class="pre">ws.send_dict['L_region']</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ws</span><span class="o">.</span><span class="n">send_dict</span><span class="p">[</span><span class="s1">&#39;L_region&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">car</span><span class="o">.</span><span class="n">get_grayscale_list</span><span class="p">()</span>
</pre></div>
</div>
</li>
<li><p>Send sensor data, device information and proofreading information of the ESP-4WD car to Sunfounder Controller through <code class="docutils literal notranslate"><span class="pre">write()</span></code> function.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">write</span><span class="p">()</span>
</pre></div>
</div>
</li>
</ul>
<p>Now, open the SunFounder Controller again, Widget D (grayscale detection tool) is showing the current ground conditions.</p>
<img alt="_images/arduino_app23.png" class="align-center" src="_images/arduino_app23.png" />
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="faq.html" class="btn btn-neutral float-right" title="FAQ" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="code_control_micropython.html" class="btn btn-neutral float-left" title="Code Control" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, SunFounder.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>