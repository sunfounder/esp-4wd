

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>APP control &mdash; esp-4wd_car_kit  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> esp-4wd_car_kit
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="Components List.html">Components List</a></li>
<li class="toctree-l1"><a class="reference internal" href="For Arduino User.html">For Arduino User</a></li>
<li class="toctree-l1"><a class="reference internal" href="For Python User.html">For Python User</a></li>
<li class="toctree-l1"><a class="reference internal" href="FAQ.html">FAQ</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">esp-4wd_car_kit</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>APP control</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/APP Control(python).rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="app-control">
<h1>APP control<a class="headerlink" href="#app-control" title="Permalink to this headline">¶</a></h1>
<p>In this chapter,你将学习使用Sunfounder Controller这款遥控器软件，并在Sunfounder Controller上diy一个遥控器来
控制小车。</p>
<div class="toctree-wrapper compound">
</div>
<div class="section" id="install-sunfounder-controller">
<h2>Install Sunfounder Controller<a class="headerlink" href="#install-sunfounder-controller" title="Permalink to this headline">¶</a></h2>
<p>Open App Store (iOS/Mac OS X system) or Play Store (Android/Windows/Linux
system), then search and download Sunfounder Controller.</p>
<a class="reference internal image-reference" href="_images/arduino_app1.png"><img alt="_images/arduino_app1.png" class="align-center" src="_images/arduino_app1.png" style="width: 500px;" /></a>
</div>
<div class="section" id="about-sunfounder-controller">
<h2>About Sunfounder Controller<a class="headerlink" href="#about-sunfounder-controller" title="Permalink to this headline">¶</a></h2>
<div class="section" id="page-introduction">
<h3>Page Introduction<a class="headerlink" href="#page-introduction" title="Permalink to this headline">¶</a></h3>
<p>Start the Sunfounder Controller.</p>
<a class="reference internal image-reference" href="_images/arduino_app2.png"><img alt="_images/arduino_app2.png" class="align-center" src="_images/arduino_app2.png" style="width: 150px;" /></a>
<p>Click the middle button to add a new controller.</p>
<a class="reference internal image-reference" href="_images/arduino_app3.png"><img alt="_images/arduino_app3.png" class="align-center" src="_images/arduino_app3.png" style="width: 450px;" /></a>
<p>Sunfounder Controller is a platform that can add custom remote control handles. It
reserves many control interfaces. There are a total of 17 areas from A to Q. Each area
has selectable widgets.</p>
<a class="reference internal image-reference" href="_images/arduino_app4.png"><img alt="_images/arduino_app4.png" class="align-center" src="_images/arduino_app4.png" style="width: 450px;" /></a>
<p>The available widgets in the large square area include joystick and cross-shaped
steering wheel.</p>
<a class="reference internal image-reference" href="_images/arduino_app5.png"><img alt="_images/arduino_app5.png" class="align-center" src="_images/arduino_app5.png" style="width: 400px;" /></a>
<p>The available widgets in the small square area include buttons, digital displays and
switches.</p>
<a class="reference internal image-reference" href="_images/arduino_app6.png"><img alt="_images/arduino_app6.png" class="align-center" src="_images/arduino_app6.png" style="width: 360px;" /></a>
<p>The available widgets for the rectangular area include slider, dial, ultrasonic radar and
grayscale detection tool.</p>
<a class="reference internal image-reference" href="_images/arduino_app7.png"><img alt="_images/arduino_app7.png" class="align-center" src="_images/arduino_app7.png" style="width: 510px;" /></a>
</div>
<div class="section" id="widget-list">
<h3>Widget List<a class="headerlink" href="#widget-list" title="Permalink to this headline">¶</a></h3>
<p>For the convenience of writing code, this chapter will introduce the use of various
widgets on Sunfounder Controller, the parameter types and ranges of control widgets,
and the parameter types and ranges of display widgets.</p>
<p>The control widgets of Sunfounder Controller include buttons, switches, joystick,
cross-shaped steering wheel, and slider.</p>
<p>You can modify the widget name and the parameter range of some widgets by clicking
the icon in the upper right corner of the widget.</p>
<a class="reference internal image-reference" href="_images/arduino_app8.png"><img alt="_images/arduino_app8.png" class="align-center" src="_images/arduino_app8.png" style="width: 550px;" /></a>
<p>When we use these control widgets, ESP-4WD RDP will receive the control data.
Through these control data, we can write code to control the car.</p>
<a class="reference internal image-reference" href="_images/arduino_app9.png"><img alt="_images/arduino_app9.png" class="align-center" src="_images/arduino_app9.png" style="width: 700px;" /></a>
<p>The display widget of Sunfounder Controller includes digital displays, dial, ultrasonic
radar, and grayscale detection tool.</p>
<p>When we send sensor data to these display widgets, we can display the data on the
corresponding widgets. At the same time, you can also modify the name, unit and
parameter range of the display widget by clicking the icon in the upper right
corner.</p>
<a class="reference internal image-reference" href="_images/arduino_app10.png"><img alt="_images/arduino_app10.png" class="align-center" src="_images/arduino_app10.png" style="width: 700px;" /></a>
</div>
</div>
<div class="section" id="establish-communication">
<h2>Establish communication<a class="headerlink" href="#establish-communication" title="Permalink to this headline">¶</a></h2>
<p>In addition to the code control method, we also provide the APP control method.
You can open Sunfounder Controller on mobile phones, tablets and other devices,
and then make a controller to control ESP-4WD Car.</p>
<div class="section" id="id1">
<h3>运行代码<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>Open the ws.py file in the MicroPython device.</p>
<a class="reference internal image-reference" href="_images/python_app1.png"><img alt="_images/python_app1.png" class="align-center" src="_images/python_app1.png" style="width: 180px;" /></a>
</div>
<div class="section" id="ap-mode">
<h3>AP mode<a class="headerlink" href="#ap-mode" title="Permalink to this headline">¶</a></h3>
<p>There are two ways to establish communication between Sunfounder Controller
and ESP32 RDP: One is AP mode, the other is STA mode. We can switch the
communication mode by modifying the code of ws.py.</p>
<p>If you want to use AP mode, you need to connect Sunfounder Contorller to the hotspot released by ESP32 RDP.
Move the code to line 10, please set SSID and PSK here.（代码中的NAME既是SSID，同时也是小车的名字） If you have more than one EPS-4WD Cars, you need to
set different NAMEs for them to avoid a wrong connection. In addition, you need to set a password of more
than 8 digits.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">NAME</span> <span class="o">=</span> <span class="s1">&#39;ESP-4WD Car&#39;</span>
<span class="n">AP_PASSWORD</span> <span class="o">=</span> <span class="s2">&quot;123456789&quot;</span>
</pre></div>
</div>
<p>Then modify the content of line 10 and define the SWITCH_MODE variable as “ap”.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">SWITCH_MODE</span> <span class="o">=</span> <span class="s2">&quot;ap&quot;</span>
</pre></div>
</div>
<p>After downloading the code, ESP32 RDP will send a hotspot signal, then take out your
electronic device, open the WLAN management interface and connect to the wifi
network.</p>
<a class="reference internal image-reference" href="_images/arduino_app12.png"><img alt="_images/arduino_app12.png" class="align-center" src="_images/arduino_app12.png" style="width: 400px;" /></a>
<p>打开Sunfounder Controller，点击右上方的连接图标。</p>
<a class="reference internal image-reference" href="_images/arduino_app_new1.png"><img alt="_images/arduino_app_new1.png" class="align-center" src="_images/arduino_app_new1.png" style="width: 300px;" /></a>
<p>连接成功会出现提示框。</p>
<a class="reference internal image-reference" href="_images/arduino_app_new2.png"><img alt="_images/arduino_app_new2.png" class="align-center" src="_images/arduino_app_new2.png" style="width: 400px;" /></a>
<p>并且在sunfounder的界面上会显示小车的名字。</p>
<a class="reference internal image-reference" href="_images/arduino_app_new3.png"><img alt="_images/arduino_app_new3.png" class="align-center" src="_images/arduino_app_new3.png" style="width: 300px;" /></a>
</div>
<div class="section" id="sta-mode">
<h3>STA mode<a class="headerlink" href="#sta-mode" title="Permalink to this headline">¶</a></h3>
<p>If you want to use AP mode, you need to connect Sunfounder Controller and ESP32 RDP to the same LAN.
Turn the code to line 12, there are two macros that define the wifi information. ESP32
RDP will search for and connect to this wifi, and at the same time your electronic
device should connect to this wifi.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">STA_NAME</span> <span class="o">=</span> <span class="s2">&quot;MakerStarsHall&quot;</span>
<span class="n">STA_PASSWORD</span> <span class="o">=</span> <span class="s2">&quot;sunfounder&quot;</span>
</pre></div>
</div>
<p>Then modify the content of line 14 and define the SWITCH_MODE variable as “sta”.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">SWITCH_MODE</span> <span class="o">=</span> <span class="s2">&quot;sta&quot;</span>
</pre></div>
</div>
<p>After downloading the code, ESP32 RDP will automatically connect to the wifi network
, and at the same time take out your electronic device, open the WLAN management interface
and connect to this wifi network.</p>
<a class="reference internal image-reference" href="_images/arduino_app13.png"><img alt="_images/arduino_app13.png" class="align-center" src="_images/arduino_app13.png" style="width: 400px;" /></a>
<p>打开Sunfounder Controller，点击右上方的连接图标。</p>
<a class="reference internal image-reference" href="_images/arduino_app_new1.png"><img alt="_images/arduino_app_new1.png" class="align-center" src="_images/arduino_app_new1.png" style="width: 300px;" /></a>
<p>在弹出的确认框中找到小车名字，点击它。</p>
<a class="reference internal image-reference" href="_images/arduino_app_new4.png"><img alt="_images/arduino_app_new4.png" class="align-center" src="_images/arduino_app_new4.png" style="width: 450px;" /></a>
<p>连接成功后，在sunfounder的界面上会显示小车的名字。</p>
<a class="reference internal image-reference" href="_images/arduino_app_new3.png"><img alt="_images/arduino_app_new3.png" class="align-center" src="_images/arduino_app_new3.png" style="width: 300px;" /></a>
</div>
</div>
<div class="section" id="app">
<h2>APP操作<a class="headerlink" href="#app" title="Permalink to this headline">¶</a></h2>
<p>Download this code, and then using any of the above methods to establish
communication.</p>
<div class="section" id="id2">
<h3>添加按键<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>Open Sunfounder Controller, and then 新建 an empty controller.</p>
<a class="reference internal image-reference" href="_images/arduino_app3.png"><img alt="_images/arduino_app3.png" class="align-center" src="_images/arduino_app3.png" style="width: 450px;" /></a>
<p>As shown in the figure, select the corresponding widget for the controller. After
adding, click the icon in the upper right corner to save the configuration.</p>
<a class="reference internal image-reference" href="_images/arduino_app14.png"><img alt="_images/arduino_app14.png" class="align-center" src="_images/arduino_app14.png" style="width: 450px;" /></a>
<p>Click the start button in the upper right corner, and then try to use this controller to
control ESP-4WD Car.</p>
<p>Widget A is used to display the driving speed of the car.</p>
<p>Widget D is used to simulate radar scanning.</p>
<p>Widget H is used to control the driving speed of the car.</p>
<p>Widget K is used to control the driving direction of the car.</p>
<p>Widget L is used to display the detection result of the grayscale sensor.</p>
<p>Widget M is used to control the on and off of the RGB board.</p>
<a class="reference internal image-reference" href="_images/arduino_app15.png"><img alt="_images/arduino_app15.png" class="align-center" src="_images/arduino_app15.png" style="width: 450px;" /></a>
</div>
</div>
<div class="section" id="diy">
<h2>DIY遥控器<a class="headerlink" href="#diy" title="Permalink to this headline">¶</a></h2>
<p>如果你想要DIY一个新的遥控器，你需要了解ESP32 RDP和Sunfounder Controller之间的通信过程。Open the
test_control.py file. 你将通过这个代码来了解它们之间的通信。</p>
<div class="section" id="program-framework">
<h3>Program framework<a class="headerlink" href="#program-framework" title="Permalink to this headline">¶</a></h3>
<p>First, let us understand the general operating framework of the program.</p>
<p>Turn the code to line 34. In the main() function, we have written the basic
implementation code for build a controller.</p>
<p>ws.start(): Establish communication between ESP-4WD RDP and Sunfounder
Controller.</p>
<p>result = read(): Read the received data and store it in the result variable.</p>
<p>write()：Send sensor data to Sunfounder Controller.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">ws</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;start&quot;</span><span class="p">)</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">read</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">result</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># coding the control function here.</span>

            <span class="c1"># coding the sensor function here.</span>

            <span class="c1"># ws.send_dict[&#39;L_region&#39;] = car.get_grayscale_list() # example for test sensor date sending.</span>
            <span class="n">write</span><span class="p">()</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep_ms</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
</pre></div>
</div>
<p>Open the ws.py file, turn the code to line 87, in the start() function, we switch the
communication mode by judging the value of SWITCH_MODE.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># self.stop()</span>
    <span class="k">if</span> <span class="n">SWITCH_MODE</span> <span class="o">==</span> <span class="s2">&quot;ap&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wlan</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">WLAN</span><span class="p">(</span><span class="n">network</span><span class="o">.</span><span class="n">AP_IF</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wlan</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">essid</span><span class="o">=</span><span class="n">AP_NAME</span><span class="p">,</span> <span class="n">authmode</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">AP_PASSWORD</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wlan</span><span class="o">.</span><span class="n">active</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># turning on the hotspot</span>
    <span class="k">elif</span> <span class="n">SWITCH_MODE</span> <span class="o">==</span> <span class="s2">&quot;sta&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wlan</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">WLAN</span><span class="p">(</span><span class="n">network</span><span class="o">.</span><span class="n">STA_IF</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wlan</span><span class="o">.</span><span class="n">active</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wlan</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">STA_NAME</span><span class="p">,</span> <span class="n">STA_PASSWORD</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h3>接收过程<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>在ESP32 RDP会与Sunfounder Controller的通信过程会产生数据交互，ESP32 RDP既会接收来自Sunfounder Controller的数据，
也会将自身的传感器数据发送给Sunfounder Controller。所以我们先来了解一下ESP32 RDP从Sunfounder Controller接收了
哪些数据。</p>
<p><strong>Step 1:创建遥控器</strong></p>
<p>Run the test_control.py file, re-establish communication, and then open Sunfounder Controller to create
a new controller. We add a slider in the H area and a cross-shaped steering wheel in the K area. After
adding, click the icon in the upper right corner to save.</p>
<a class="reference internal image-reference" href="_images/arduino_app16.png"><img alt="_images/arduino_app16.png" class="align-center" src="_images/arduino_app16.png" style="width: 450px;" /></a>
<p><strong>Step 2:小车接收控件的值</strong></p>
<p>Turn the code to line 14, in the read() function, we realized the receiving and printing
of the data sent by the Sunfounder Controller. The function of the temp variable is to
prevent repeated printing of data.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">read</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">temp</span>
    <span class="n">recv</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">recv</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">recv_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">recv</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">temp</span> <span class="o">!=</span> <span class="n">recv_data</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;recv_data: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">recv_data</span><span class="p">)</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">recv_data</span>
    <span class="k">return</span> <span class="n">recv_data</span>
</pre></div>
</div>
<p>Receive the Json object sent by Sunfounder Controller through the ws.read()
function and store it in the recv variable.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">recv</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div>
</div>
<p>Parse recv variable (Json object format) into recv_data dictionary through the
json.loads( ) function.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">recv_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">recv</span><span class="p">)</span>
</pre></div>
</div>
<p>Print recv_data variable.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;recv_data: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">recv_data</span><span class="p">)</span>
</pre></div>
</div>
<p>Click the start icon in the upper right corner to run the controller.</p>
<a class="reference internal image-reference" href="_images/arduino_app17.png"><img alt="_images/arduino_app17.png" class="align-center" src="_images/arduino_app17.png" style="width: 250px;" /></a>
<p>Open the Shell window under Thonny, we can find that the initial data of K
control is the string “stop”, and the initial data of H widget is the int value 50.</p>
<a class="reference internal image-reference" href="_images/arduino_app18.png"><img alt="_images/arduino_app18.png" class="align-center" src="_images/arduino_app18.png" style="width: 450px;" /></a>
<p>按住K区域的cross-shaped steering wheel的不同方向键，并且滑动H区域的slider。</p>
<a class="reference internal image-reference" href="_images/arduino_app19.png"><img alt="_images/arduino_app19.png" class="align-center" src="_images/arduino_app19.png" style="width: 450px;" /></a>
<p>You can see that the cross-shaped steering
wheel widget sends a string of data (“forward”, “backward”, “left”, “right”) to the ESP-
4WD RDP. The slider widget will send an int data (range: 0-100) to the ESP-4WD RDP.</p>
<a class="reference internal image-reference" href="_images/arduino_app20.png"><img alt="_images/arduino_app20.png" class="align-center" src="_images/arduino_app20.png" style="width: 450px;" /></a>
<p><strong>Step 3:小车响应</strong></p>
<p>当ESP-4WD Car接收到来自Sunfounder Controller不同控件的数据时，它需要做出相应的响应。
Let’s write a piece of code that uses the widgets on the Sunfounder Controller
to control the movement of the car. The K widget(cross-shaped steering wheel) controls
the direction of the car, and the H widget(slider) controls the speed of the car.</p>
<p>Turn the code to line 43，我们将以下代码添加在这一行里。（有部分被注释的内容未展示，请不要将它们删除。）</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">ws</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;start&quot;</span><span class="p">)</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">read</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">result</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">car</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;K_region&#39;</span><span class="p">],</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;H_region&#39;</span>
            <span class="c1"># ws.send_dict[&#39;L_region&#39;] = car.get_grayscale_list() # example for test sensor date sending.</span>
            <span class="n">write</span><span class="p">()</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep_ms</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
</pre></div>
</div>
<p>Through the read() function, you can receive the data sent by Sunfounder
Controller and store it in the result dictionary.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">read</span><span class="p">()</span>
</pre></div>
</div>
<p>The value of doc_recv[“K_region”] is the string data (“forward”, “backward”,”left”,
“right”) sent by the K widget (cross-shaped steering wheel), the same as the value of
doc_recv[“H_region”] is the int data sent by H widget (slide) (range: 0-100).</p>
<p>Pass doc_recv[“K_region”] as the first parameter to the car.move() function to control
the direction of the ESP-4WD Car. Pass doc_recv[“H_region”] as the second parameter
to the car.move() function to control the speed of ESP-4WD Car.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">car</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;K_region&#39;</span><span class="p">],</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;H_region&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>After downloading the modified code and re-establishing communication, open the
controller and click the start icon in the upper right corner to run the controller.
The cross-shaped steering wheel in the K area can control the direction of the ESP-
4WD Car, and the slider in the H area can control the speed of the ESP-4WD Car.</p>
<a class="reference internal image-reference" href="_images/arduino_app17.png"><img alt="_images/arduino_app17.png" class="align-center" src="_images/arduino_app17.png" style="width: 250px;" /></a>
</div>
<div class="section" id="id4">
<h3>发送过程<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>我们再来了解一下ESP32 RDP是如何将自身的传感器数据发送给Sunfounder Controller。</p>
<p><strong>Step 1:创建遥控器</strong></p>
<p>Open the <strong>ws.py</strong> file and turn the code to line 25. Here, the equipment information and proofreading
information of ESP-4WD Car are stored in the send_dict dictionary.（有部分被注释的内容未展示，请不要将它们删除。）</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">send_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Name&#39;</span><span class="p">:</span><span class="n">AP_NAME</span><span class="p">,</span>
    <span class="s1">&#39;Type&#39;</span><span class="p">:</span><span class="s1">&#39;ESP-4WD Car&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Check&#39;</span><span class="p">:</span><span class="s1">&#39;SunFounder Controller&#39;</span><span class="p">,</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>Open the <strong>test_control.py</strong> file and turn the code to line 44, delete the comment symbol for this code.
Obtain the grayscale sensor data through the car.get_grayscale_list() function and store it in the
ws.send_dict dictionary with the key’L_region’.</p>
<p>Turn the code to line 44, through the write() function, we send sensor data to the Sunfounder Controller,
where the temp_send variable is used to prevent repeated printing of data.</p>
<p>我们来解释一下这段代码。First, use the json.dumps() function to convert the ws.send_dict dictionary into
a Json object, and then use the ws.write() function to send the Json object storing the
sensor data to the Sunfounder Controller.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ws</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">send_dict</span><span class="p">))</span>
</pre></div>
</div>
<p>然后Print the value of the ws.send_dict dictionary.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;send_data:</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">ws</span><span class="o">.</span><span class="n">send_dict</span><span class="p">)</span>
</pre></div>
</div>
<p>Download this code again, and turn on the controller after establishing communication.</p>
<p>Open the Shell window under Thonny, you will see that the ESP-4WD RDP has been
sending device information, calibration information and the value of the grayscale
sensor to the Sunfounder Controller.</p>
<a class="reference internal image-reference" href="_images/arduino_app22.png"><img alt="_images/arduino_app22.png" class="align-center" src="_images/arduino_app22.png" style="width: 450px;" /></a>
<p><strong>Step 3:小车响应</strong></p>
<p>Let’s write a piece of code that display the sensor data of ESP-4WD RDP on the
widget of Sunfounder Controller.Widget D (grayscale detection tool)将会根据检测到的灰度值显示地面情况。</p>
<p>Turn the code to line 34, 我们来重新解释一下main()函数的内容。</p>
<p>通过car.get_grayscale_list()函数，我们可以获取储存着灰度传感器检测值的列表，
并将列表里的内容赋值给doc_send[“L_region”]。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ws</span><span class="o">.</span><span class="n">send_dict</span><span class="p">[</span><span class="s1">&#39;L_region&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">car</span><span class="o">.</span><span class="n">get_grayscale_list</span><span class="p">()</span>
</pre></div>
</div>
<p>Send sensor data, device information and proofreading information of the ESP-4WD RDP
to Sunfounder Controller through write() function.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">write</span><span class="p">()</span>
</pre></div>
</div>
<p>回到遥控器界面，Widget D(grayscale detection tool)正在显示当前地面情况，如果想要知道更多关于控件的信息，请回到
Widget List查看。</p>
<a class="reference internal image-reference" href="_images/arduino_app23.png"><img alt="_images/arduino_app23.png" class="align-center" src="_images/arduino_app23.png" style="width: 250px;" /></a>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, SunFounder.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>