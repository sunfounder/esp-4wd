

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Code Control &mdash; esp-4wd_car_kit  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="APP control" href="app_control_arduino.html" />
    <link rel="prev" title="小车控制" href="play_arduino.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> esp-4wd_car_kit
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Components List.html">Components List</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="For Arduino User.html">For Arduino User</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="config_and_installation_arduino.html">软件配置和安装</a></li>
<li class="toctree-l2"><a class="reference internal" href="component_testing_arduino.html">器件测试</a></li>
<li class="toctree-l2"><a class="reference internal" href="hardware_assembly_arduino.html">Hardware Assembling</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="play_arduino.html">小车控制</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Code Control</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#move">move</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ultrasonic">ultrasonic</a></li>
<li class="toctree-l4"><a class="reference internal" href="#grayvalue">grayValue</a></li>
<li class="toctree-l4"><a class="reference internal" href="#flashinglight">flashingLight</a></li>
<li class="toctree-l4"><a class="reference internal" href="#waterfalllight">waterfallLight</a></li>
<li class="toctree-l4"><a class="reference internal" href="#measurespeed">measureSpeed</a></li>
<li class="toctree-l4"><a class="reference internal" href="#moreplay">morePlay</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="app_control_arduino.html">APP control</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="For Python User.html">For Python User</a></li>
<li class="toctree-l1"><a class="reference internal" href="FAQ.html">FAQ</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">esp-4wd_car_kit</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="For Arduino User.html">For Arduino User</a> &raquo;</li>
        
          <li><a href="play_arduino.html">小车控制</a> &raquo;</li>
        
      <li>Code Control</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/code_control_arduino.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="code-control">
<h1>Code Control<a class="headerlink" href="#code-control" title="Permalink to this headline">¶</a></h1>
<p>In this chapter, we are provided with method of arduino control. Open esp-4wdArduinoexample, you can see a total of 7 code examples, you can use these 7
examples to quickly get started using the ESP-4WD Car.</p>
<a class="reference internal image-reference" href="_images/arduino_code1.png"><img alt="_images/arduino_code1.png" class="align-center" src="_images/arduino_code1.png" style="width: 200px;" /></a>
<div class="toctree-wrapper compound">
</div>
<div class="section" id="move">
<h2>move<a class="headerlink" href="#move" title="Permalink to this headline">¶</a></h2>
<p>Open the 1.move.ino file with arduino, After running this example, the car will go
forward 1s, go backward 1s, turn left 1s, turn right 1s at 30% speed, and finally stop.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;ESP32_RDP.h&quot;</span><span class="cp"></span>

<span class="n">ESP32car</span> <span class="n">car</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
<span class="n">car</span><span class="p">.</span><span class="n">move</span><span class="p">(</span><span class="s">&quot;forward&quot;</span><span class="p">,</span> <span class="mi">30</span><span class="p">);</span>
<span class="n">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
<span class="n">car</span><span class="p">.</span><span class="n">move</span><span class="p">(</span><span class="s">&quot;backward&quot;</span><span class="p">,</span> <span class="mi">30</span><span class="p">);</span>
<span class="n">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
<span class="n">car</span><span class="p">.</span><span class="n">move</span><span class="p">(</span><span class="s">&quot;left&quot;</span><span class="p">,</span> <span class="mi">30</span><span class="p">);</span>
<span class="n">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
<span class="n">car</span><span class="p">.</span><span class="n">move</span><span class="p">(</span><span class="s">&quot;right&quot;</span><span class="p">,</span> <span class="mi">30</span><span class="p">);</span>
<span class="n">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
<span class="n">car</span><span class="p">.</span><span class="n">move</span><span class="p">(</span><span class="s">&quot;stop&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="ultrasonic">
<h2>ultrasonic<a class="headerlink" href="#ultrasonic" title="Permalink to this headline">¶</a></h2>
<p>Run 2.ultrasonic.ino, the serial port of arduino will always print the distance value read
by the ultrasonic module.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;ESP32_RDP.h&quot;</span><span class="cp"></span>

<span class="n">Ultrasonic</span> <span class="nf">ult</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span><span class="mi">12</span><span class="p">);</span>
<span class="kt">float</span> <span class="n">dis</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
<span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
<span class="n">dis</span> <span class="o">=</span> <span class="n">ult</span><span class="p">.</span><span class="n">read_distance</span><span class="p">();</span>
<span class="n">Serial</span><span class="p">.</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;distance: %.2f </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">dis</span><span class="p">);</span>
<span class="n">delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Click the icon in the upper right corner to open the serial debugging assistant, Set the
baud rate to 115200.</p>
<a class="reference internal image-reference" href="_images/arduino_test3-1.png"><img alt="_images/arduino_test3-1.png" class="align-center" src="_images/arduino_test3-1.png" style="width: 400px;" /></a>
</div>
<div class="section" id="grayvalue">
<h2>grayValue<a class="headerlink" href="#grayvalue" title="Permalink to this headline">¶</a></h2>
<p>Run 3.grayValue.ino, the serial port of arduino will always print the reading value of the
grayscale sensor.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;ESP32_RDP.h&quot;</span><span class="cp"></span>

<span class="n">ESP32car</span> <span class="n">car</span><span class="p">;</span>

<span class="kt">int</span> <span class="n">grayValue</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
<span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">car</span><span class="p">.</span><span class="n">get_grayscale</span><span class="p">();</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">grayValue</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">car</span><span class="p">.</span><span class="n">adc_value</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;grayValue:&quot;</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot; %d&quot;</span><span class="p">,</span> <span class="n">grayValue</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;  %d&quot;</span><span class="p">,</span> <span class="n">grayValue</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;  %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">grayValue</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="flashinglight">
<h2>flashingLight<a class="headerlink" href="#flashinglight" title="Permalink to this headline">¶</a></h2>
<p>Run 4.flashingLight.ino, the RGB light under the car flashes every 0.5 seconds and
changes color every time it flashes.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;ESP32_RDP.h&quot;</span><span class="cp"></span>

<span class="n">ESP32car</span> <span class="n">car</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
<span class="n">car</span><span class="p">.</span><span class="n">set_light_color</span><span class="p">(</span><span class="n">random</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span> <span class="n">random</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span> <span class="n">random</span><span class="p">(</span><span class="mi">255</span><span class="p">));</span>
<span class="n">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
<span class="n">car</span><span class="p">.</span><span class="n">set_light_off</span><span class="p">();</span>
<span class="n">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="waterfalllight">
<h2>waterfallLight<a class="headerlink" href="#waterfalllight" title="Permalink to this headline">¶</a></h2>
<p>Run 5.waterfallLight.ino, the RGB lights under the car will gradually turn on from the
first to the twenty-fourth, and then turn off from the end to the middle. After that,
the RGB lights will turn on from the twenty-fourth to the first, and then turn off from
the end to the middle.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;ESP32_RDP.h&quot;</span><span class="cp"></span>

<span class="n">ESP32car</span> <span class="n">car</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
<span class="kt">int</span> <span class="n">red</span> <span class="o">=</span> <span class="n">random</span><span class="p">(</span><span class="mi">255</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">green</span> <span class="o">=</span> <span class="n">random</span><span class="p">(</span><span class="mi">255</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">blue</span> <span class="o">=</span> <span class="n">random</span><span class="p">(</span><span class="mi">255</span><span class="p">);</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">24</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">car</span><span class="p">.</span><span class="n">set_num_light</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">red</span><span class="p">,</span> <span class="n">green</span><span class="p">,</span> <span class="n">blue</span><span class="p">);</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">23</span><span class="p">;</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">11</span><span class="p">;</span> <span class="n">i</span><span class="o">--</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">23</span> <span class="o">-</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">car</span><span class="p">.</span><span class="n">set_num_light</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">car</span><span class="p">.</span><span class="n">set_num_light</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">40</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">23</span><span class="p">;</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">--</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">car</span><span class="p">.</span><span class="n">set_num_light</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">red</span><span class="p">,</span> <span class="n">green</span><span class="p">,</span> <span class="n">blue</span><span class="p">);</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">23</span><span class="p">;</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">11</span><span class="p">;</span> <span class="n">i</span><span class="o">--</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">23</span> <span class="o">-</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">car</span><span class="p">.</span><span class="n">set_num_light</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">car</span><span class="p">.</span><span class="n">set_num_light</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">40</span><span class="p">);</span>
<span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>The sentence to light up the LED is car.set_num_light(i, red, green, blue); the first
parameter is the number of the light, and the last three parameters are the RGB value.
For example, car.set_num_light(4,255,0,0) means to make the No. 4 LED light up in
red.</p>
<a class="reference internal image-reference" href="_images/arduino_code1.png"><img alt="_images/arduino_code1.png" class="align-center" src="_images/arduino_code1.png" style="width: 300px;" /></a>
</div>
<div class="section" id="measurespeed">
<h2>measureSpeed<a class="headerlink" href="#measurespeed" title="Permalink to this headline">¶</a></h2>
<p>Run 6.measureSpeed.ino, the car will move at a random speed, and the 2-ch Photo-
interrupter Module will detect the speed of the car.</p>
<p>The light emitted from the transmitting end of the 2-ch Photo-interrupter Module
to the receiving end will pass through the Encoding Disk (which has 20 holes). When
the receiving end does not receive the light, it will send a “0” to the microcontroller,
otherwise it will send a “1”.</p>
<p>This means that when a total of 20 “1”s are detected, the small wheel has turned one
round (a distance of the wheel circumference has been traveled forward).</p>
<p>In the same way, we can detect the frequency of the “1” received by the
microcontroller and calculate the speed of the trolley in cm/s.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;ESP32_RDP.h&quot;</span><span class="cp"></span>

<span class="n">ESP32car</span> <span class="n">car</span><span class="p">;</span>

<span class="cp">#define SPEED_PIN_LEFT    26</span>
<span class="cp">#define SPEED_PIN_RIGHT    25</span>

<span class="n">hw_timer_t</span> <span class="o">*</span> <span class="n">timer</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="k">volatile</span> <span class="kt">uint8_t</span> <span class="n">left_Counter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">volatile</span> <span class="kt">uint8_t</span> <span class="n">right_Counter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kt">float</span> <span class="n">carSpeed</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">on_left_Pin</span><span class="p">()</span> <span class="p">{</span>
<span class="n">left_Counter</span><span class="o">++</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">on_right_Pin</span><span class="p">()</span> <span class="p">{</span>
<span class="n">right_Counter</span><span class="o">++</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">IRAM_ATTR</span> <span class="nf">onTimer</span><span class="p">()</span> <span class="p">{</span>
<span class="n">counter</span> <span class="o">=</span> <span class="p">(</span><span class="n">left_Counter</span> <span class="o">+</span> <span class="n">right_Counter</span><span class="p">);</span>
<span class="n">left_Counter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">right_Counter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">float</span> <span class="nf">get_speed</span><span class="p">()</span> <span class="p">{</span>
<span class="kt">float</span> <span class="n">value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">value</span> <span class="o">=</span> <span class="kt">float</span><span class="p">(</span><span class="n">counter</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="o">/</span> <span class="mf">20.0</span> <span class="o">*</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="mf">3.14</span> <span class="o">*</span> <span class="mf">3.3</span><span class="p">;</span>
<span class="k">return</span> <span class="n">value</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
<span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span>
<span class="n">pinMode</span><span class="p">(</span><span class="n">SPEED_PIN_LEFT</span><span class="p">,</span> <span class="n">INPUT</span><span class="p">);</span>
<span class="n">attachInterrupt</span><span class="p">(</span><span class="n">SPEED_PIN_LEFT</span><span class="p">,</span> <span class="n">on_left_Pin</span><span class="p">,</span> <span class="n">RISING</span><span class="p">);</span>
<span class="n">pinMode</span><span class="p">(</span><span class="n">SPEED_PIN_RIGHT</span><span class="p">,</span> <span class="n">INPUT</span><span class="p">);</span>
<span class="n">attachInterrupt</span><span class="p">(</span><span class="n">SPEED_PIN_RIGHT</span><span class="p">,</span> <span class="n">on_right_Pin</span><span class="p">,</span> <span class="n">RISING</span><span class="p">);</span>
<span class="c1">// Set 80 divider for prescaler (see ESP32 Technical Reference Manual for more</span>
<span class="c1">// info).</span>
<span class="n">timer</span> <span class="o">=</span> <span class="n">timerBegin</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
<span class="c1">// Attach onTimer function to our timer.</span>
<span class="n">timerAttachInterrupt</span><span class="p">(</span><span class="n">timer</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">onTimer</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
<span class="c1">// Set alarm to call onTimer function every second (value in microseconds).</span>
<span class="c1">// Repeat the alarm (third parameter)</span>
<span class="n">timerAlarmWrite</span><span class="p">(</span><span class="n">timer</span><span class="p">,</span> <span class="mi">1000000</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
<span class="c1">// Start an alarm</span>
<span class="n">timerAlarmEnable</span><span class="p">(</span><span class="n">timer</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
<span class="kt">int</span> <span class="n">speed</span> <span class="o">=</span> <span class="n">random</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
<span class="n">car</span><span class="p">.</span><span class="n">move</span><span class="p">(</span><span class="s">&quot;forward&quot;</span><span class="p">,</span> <span class="n">speed</span><span class="p">);</span>
<span class="n">carSpeed</span> <span class="o">=</span> <span class="n">get_speed</span><span class="p">();</span>
<span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">carSpeed</span><span class="p">);</span>
<span class="n">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="moreplay">
<h2>morePlay<a class="headerlink" href="#moreplay" title="Permalink to this headline">¶</a></h2>
<p>Run 7.morePlay.ino, this example provides 4 ways to use ESP-4WD Car. You can switch
between different modes by modifying the value of the mode variable.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;ESP32_RDP.h&quot;</span><span class="cp"></span>

<span class="n">ESP32car</span> <span class="n">car</span><span class="p">;</span>

<span class="kt">int</span> <span class="n">mode</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="p">(</span><span class="n">mode</span><span class="p">)</span>
    <span class="p">{</span>
    <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
    <span class="n">car</span><span class="p">.</span><span class="n">avoid</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">30</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
    <span class="n">car</span><span class="p">.</span><span class="n">follow</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">30</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="mi">3</span><span class="o">:</span>
    <span class="n">car</span><span class="p">.</span><span class="n">is_on_edge</span><span class="p">(</span><span class="mi">110</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="mi">4</span><span class="o">:</span>
    <span class="n">car</span><span class="p">.</span><span class="n">track_line</span><span class="p">(</span><span class="mi">400</span> <span class="p">,</span> <span class="mi">50</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="function-introduction">
<h3>Function Introduction<a class="headerlink" href="#function-introduction" title="Permalink to this headline">¶</a></h3>
<p><strong>avoid()</strong></p>
<p>Modify the value of the mode variable to 1 so that the default mode is set to obstacle
avoidance. ESP-4WD Car will advance at 30% speed and return to the distance state
according to whether there is an obstacle in front (if there is an obstacle within 10cm,
return to the distance state 0, if there is an obstacle within 40cm, then return to the
distance state 1, otherwise it will Return to distance status 2). If it encounters an
obstacle, it will automatically turn right to avoid collision.</p>
<a class="reference internal image-reference" href="_images/arduino_code3.png"><img alt="_images/arduino_code3.png" class="align-center" src="_images/arduino_code3.png" style="width: 500px;" /></a>
<p><strong>follow()</strong></p>
<p>Modify the value of the mode variable to 2 so that the default mode is set to follow.
ESP-4WD Car will move forward at 30% speed and automatically follow objects within
40cm in front.</p>
<a class="reference internal image-reference" href="_images/arduino_code4.png"><img alt="_images/arduino_code4.png" class="align-center" src="_images/arduino_code4.png" style="width: 500px;" /></a>
<p><strong>cliff detection()</strong></p>
<p>Modify the value of the mode variable to 3 so that the default mode is set to cliff
detection. When ESP-4WD Car detects a cliff (a place where the grayscale sensor’s
detection value is below 110), it will retreat a certain distance.</p>
<a class="reference internal image-reference" href="_images/arduino_code5.png"><img alt="_images/arduino_code5.png" class="align-center" src="_images/arduino_code5.png" style="width: 500px;" /></a>
<p><strong>track_line()</strong></p>
<p>Modify the value of the mode variable to 4 so that the default mode is set to line
patrol. The ESP-4WD Car moves along the black line on the white ground (where the
grayscale sensor detection value is below 400).</p>
<a class="reference internal image-reference" href="_images/arduino_code6.png"><img alt="_images/arduino_code6.png" class="align-center" src="_images/arduino_code6.png" style="width: 500px;" /></a>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="app_control_arduino.html" class="btn btn-neutral float-right" title="APP control" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="play_arduino.html" class="btn btn-neutral float-left" title="小车控制" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, SunFounder.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>